[debug] [2026-01-14T05:37:31.333Z] ----------------------------------------------------------------------
[debug] [2026-01-14T05:37:31.335Z] Command:       C:\Program Files\nodejs\node.exe C:\Users\kieee\.gemini\antigravity\playground\tensor-triangulum\node_modules\firebase-tools\lib\bin\firebase.js deploy
[debug] [2026-01-14T05:37:31.335Z] CLI Version:   15.2.1
[debug] [2026-01-14T05:37:31.335Z] Platform:      win32
[debug] [2026-01-14T05:37:31.336Z] Node Version:  v24.12.0
[debug] [2026-01-14T05:37:31.336Z] Time:          Wed Jan 14 2026 14:37:31 GMT+0900 (日本標準時)
[debug] [2026-01-14T05:37:31.336Z] ----------------------------------------------------------------------
[debug] 
[debug] [2026-01-14T05:37:33.981Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2026-01-14T05:37:33.981Z] > authorizing via signed-in user (kikunouki@gmail.com)
[debug] [2026-01-14T05:37:33.981Z] [iam] checking project crossfit-tracker-48563 for permissions ["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get","firebasehosting.sites.update"]
[debug] [2026-01-14T05:37:33.982Z] Checked if tokens are valid: false, expires at: 1768361212214
[debug] [2026-01-14T05:37:33.983Z] Checked if tokens are valid: false, expires at: 1768361212214
[debug] [2026-01-14T05:37:33.983Z] > refreshing access token with scopes: []
[debug] [2026-01-14T05:37:33.985Z] >>> [apiv2][query] POST https://www.googleapis.com/oauth2/v3/token [none]
[debug] [2026-01-14T05:37:33.985Z] >>> [apiv2][body] POST https://www.googleapis.com/oauth2/v3/token [omitted]
[debug] [2026-01-14T05:37:34.171Z] <<< [apiv2][status] POST https://www.googleapis.com/oauth2/v3/token 200
[debug] [2026-01-14T05:37:34.171Z] <<< [apiv2][body] POST https://www.googleapis.com/oauth2/v3/token [omitted]
[debug] [2026-01-14T05:37:34.178Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/crossfit-tracker-48563:testIamPermissions [none]
[debug] [2026-01-14T05:37:34.178Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/crossfit-tracker-48563:testIamPermissions x-goog-quota-user=projects/crossfit-tracker-48563
[debug] [2026-01-14T05:37:34.178Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/crossfit-tracker-48563:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get","firebasehosting.sites.update"]}
[debug] [2026-01-14T05:37:34.439Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/crossfit-tracker-48563:testIamPermissions 200
[debug] [2026-01-14T05:37:34.439Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/crossfit-tracker-48563:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get","firebasehosting.sites.update"]}
[debug] [2026-01-14T05:37:34.440Z] Checked if tokens are valid: true, expires at: 1768372653171
[debug] [2026-01-14T05:37:34.440Z] Checked if tokens are valid: true, expires at: 1768372653171
[debug] [2026-01-14T05:37:34.440Z] >>> [apiv2][query] GET https://firebase.googleapis.com/v1beta1/projects/crossfit-tracker-48563 [none]
[debug] [2026-01-14T05:37:34.853Z] <<< [apiv2][status] GET https://firebase.googleapis.com/v1beta1/projects/crossfit-tracker-48563 200
[debug] [2026-01-14T05:37:34.853Z] <<< [apiv2][body] GET https://firebase.googleapis.com/v1beta1/projects/crossfit-tracker-48563 {"projectId":"crossfit-tracker-48563","projectNumber":"515310460270","displayName":"CrossFit Tracker","name":"projects/crossfit-tracker-48563","resources":{"hostingSite":"crossfit-tracker-48563"},"state":"ACTIVE","etag":"1_a4ca3e27-7f8b-41df-8b1d-5a0f7012620b"}
[info] 
[info] === Deploying to 'crossfit-tracker-48563'...
[info] 
[info] i  deploying firestore, hosting 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[debug] [2026-01-14T05:37:34.857Z] Checked if tokens are valid: true, expires at: 1768372653171
[debug] [2026-01-14T05:37:34.857Z] Checked if tokens are valid: true, expires at: 1768372653171
[debug] [2026-01-14T05:37:34.857Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/crossfit-tracker-48563/databases/(default) [none]
[debug] [2026-01-14T05:37:35.835Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/crossfit-tracker-48563/databases/(default) 200
[debug] [2026-01-14T05:37:35.835Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/crossfit-tracker-48563/databases/(default) {"name":"projects/crossfit-tracker-48563/databases/(default)","uid":"613fcf0d-08ce-49b6-b168-723cd4e97188","createTime":"2025-12-25T04:36:06.247128Z","updateTime":"2025-12-25T04:36:06.247128Z","locationId":"nam5","type":"FIRESTORE_NATIVE","concurrencyMode":"PESSIMISTIC","versionRetentionPeriod":"3600s","earliestVersionTime":"2026-01-14T04:37:35.415197Z","appEngineIntegrationMode":"DISABLED","keyPrefix":"s","pointInTimeRecoveryEnablement":"POINT_IN_TIME_RECOVERY_DISABLED","deleteProtectionState":"DELETE_PROTECTION_DISABLED","databaseEdition":"STANDARD","freeTier":true,"realtimeUpdatesMode":"REALTIME_UPDATES_MODE_ENABLED","etag":"ILDzhIuoipIDMNTTgMiY2JED"}
[info] i  firestore: reading indexes from firestore.indexes.json... 
[info] i  cloud.firestore: checking firestore.rules for compilation errors... 
[debug] [2026-01-14T05:37:35.837Z] Checked if tokens are valid: true, expires at: 1768372653171
[debug] [2026-01-14T05:37:35.837Z] Checked if tokens are valid: true, expires at: 1768372653171
[debug] [2026-01-14T05:37:35.837Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/crossfit-tracker-48563:test [none]
[debug] [2026-01-14T05:37:35.837Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/crossfit-tracker-48563:test [omitted]
[debug] [2026-01-14T05:37:37.054Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/crossfit-tracker-48563:test 200
[debug] [2026-01-14T05:37:37.054Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/crossfit-tracker-48563:test {}
[info] +  cloud.firestore: rules file firestore.rules compiled successfully 
[debug] [2026-01-14T05:37:37.058Z] Checked if tokens are valid: true, expires at: 1768372653171
[debug] [2026-01-14T05:37:37.058Z] Checked if tokens are valid: true, expires at: 1768372653171
[debug] [2026-01-14T05:37:37.058Z] >>> [apiv2][query] POST https://firebasehosting.googleapis.com/v1beta1/projects/-/sites/crossfit-tracker-48563/versions [none]
[debug] [2026-01-14T05:37:37.058Z] >>> [apiv2][body] POST https://firebasehosting.googleapis.com/v1beta1/projects/-/sites/crossfit-tracker-48563/versions {"status":"CREATED","labels":{"deployment-tool":"cli-firebase"}}
[debug] [2026-01-14T05:37:38.318Z] <<< [apiv2][status] POST https://firebasehosting.googleapis.com/v1beta1/projects/-/sites/crossfit-tracker-48563/versions 200
[debug] [2026-01-14T05:37:38.318Z] <<< [apiv2][body] POST https://firebasehosting.googleapis.com/v1beta1/projects/-/sites/crossfit-tracker-48563/versions {"name":"projects/515310460270/sites/crossfit-tracker-48563/versions/78f1ab41ae9154af","status":"CREATED","config":{},"labels":{"deployment-tool":"cli-firebase"}}
[debug] [2026-01-14T05:37:38.319Z] Checked if tokens are valid: true, expires at: 1768372653171
[debug] [2026-01-14T05:37:38.319Z] Checked if tokens are valid: true, expires at: 1768372653171
[debug] [2026-01-14T05:37:38.319Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/crossfit-tracker-48563/releases pageSize=10&pageToken=
[debug] [2026-01-14T05:37:38.726Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/crossfit-tracker-48563/releases 200
[debug] [2026-01-14T05:37:38.727Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/crossfit-tracker-48563/releases {"releases":[{"name":"projects/crossfit-tracker-48563/releases/cloud.firestore","rulesetName":"projects/crossfit-tracker-48563/rulesets/ce2cae49-edbe-458f-a922-20a7a214ebf6","createTime":"2025-12-25T04:36:14.453526Z","updateTime":"2026-01-14T02:26:59.235634Z"}]}
[debug] [2026-01-14T05:37:38.727Z] Checked if tokens are valid: true, expires at: 1768372653171
[debug] [2026-01-14T05:37:38.727Z] Checked if tokens are valid: true, expires at: 1768372653171
[debug] [2026-01-14T05:37:38.727Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/crossfit-tracker-48563/rulesets/ce2cae49-edbe-458f-a922-20a7a214ebf6 [none]
[debug] [2026-01-14T05:37:39.774Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/crossfit-tracker-48563/rulesets/ce2cae49-edbe-458f-a922-20a7a214ebf6 200
[debug] [2026-01-14T05:37:39.774Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/crossfit-tracker-48563/rulesets/ce2cae49-edbe-458f-a922-20a7a214ebf6 [omitted]
[info] i  firestore: uploading rules firestore.rules... 
[debug] [2026-01-14T05:37:39.775Z] Checked if tokens are valid: true, expires at: 1768372653171
[debug] [2026-01-14T05:37:39.775Z] Checked if tokens are valid: true, expires at: 1768372653171
[debug] [2026-01-14T05:37:39.775Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/crossfit-tracker-48563/rulesets [none]
[debug] [2026-01-14T05:37:39.775Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/crossfit-tracker-48563/rulesets [omitted]
[debug] [2026-01-14T05:37:40.851Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/crossfit-tracker-48563/rulesets 200
[debug] [2026-01-14T05:37:40.851Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/crossfit-tracker-48563/rulesets {"name":"projects/crossfit-tracker-48563/rulesets/ac3cdffb-a428-429e-879b-815906669896","source":{"files":[{"content":"rules_version = '2';\n\nservice cloud.firestore {\n  match /databases/{database}/documents {\n    \n    // --- Helper Functions ---\n    \n    function isSignedIn() {\n      return request.auth != null;\n    }\n\n    function isOwner(userId) {\n      return isSignedIn() && request.auth.uid == userId;\n    }\n\n    function getUserData() {\n      return get(/databases/$(database)/documents/users/$(request.auth.uid)).data;\n    }\n\n    function getRole() {\n      return getUserData().role;\n    }\n\n    function getBoxId() {\n      return getUserData().boxId;\n    }\n\n    function isSuperAdmin() {\n      // Hardcoded Super Admin UIDs or special flag\n      return isSignedIn() && (\n        getUserData().isSuperAdmin == true || \n        request.auth.uid in ['SUPER_ADMIN_UID_PLACEHOLDER']\n      );\n    }\n\n    function isAdmin() {\n      return isSignedIn() && (getRole() == 'admin' || isSuperAdmin());\n    }\n\n    function isCoach() {\n      return isSignedIn() && (getRole() == 'coach' || getRole() == 'admin' || isSuperAdmin());\n    }\n\n    function isMemberOfBox(boxId) {\n      return isSignedIn() && (getBoxId() == boxId || isSuperAdmin());\n    }\n\n    function isAdminOfBox(boxId) {\n      return isAdmin() && (getBoxId() == boxId || isSuperAdmin());\n    }\n\n    function isCoachOfBox(boxId) {\n      return isCoach() && (getBoxId() == boxId || isSuperAdmin());\n    }\n\n    // --- Rules ---\n\n    // ユーザードキュメント\n    match /users/{userId} {\n      allow read: if isOwner(userId) || isSuperAdmin() || (\n        isSignedIn() && getBoxId() != null && getBoxId() == resource.data.boxId && isCoach()\n      );\n      \n      allow create: if isSignedIn() && request.auth.uid == userId;\n      \n      allow update: if isOwner(userId) && (\n        // Prevent users from changing their own role or boxId\n        !request.resource.data.diff(resource.data).affectedKeys().hasAny(['role', 'boxId', 'isSuperAdmin'])\n      ) || isSuperAdmin() || (\n        isAdminOfBox(resource.data.boxId) && \n        request.resource.data.diff(resource.data).affectedKeys().hasOnly(['role', 'visitorExpiresAt'])\n      );\n\n      match /history/{historyId} {\n        allow read, write: if isOwner(userId);\n      }\n    }\n\n    // BOX (Gym) Documents\n    match /boxes/{boxId} {\n      allow read: if isSignedIn() && (getBoxId() == boxId || isSuperAdmin());\n      allow write: if isSuperAdmin(); // Box creation is restricted\n\n      // Box-specific Classes\n      match /classes/{classId} {\n        allow read: if isMemberOfBox(boxId);\n        allow write: if isCoachOfBox(boxId);\n\n        // Class Leaderboard (Scores)\n        match /scores/{scoreUserId} {\n          allow read: if isMemberOfBox(boxId);\n          allow write: if isOwner(scoreUserId) || isAdminOfBox(boxId);\n        }\n      }\n\n      // Box-specific Attendance\n      match /attendance/{attendanceId} {\n        allow read: if isMemberOfBox(boxId);\n        allow create: if isSignedIn() && request.resource.data.userId == request.auth.uid && isMemberOfBox(boxId);\n        allow delete: if isCoachOfBox(boxId);\n      }\n    }\n    \n    // Invitations\n    match /invitations/{inviteId} {\n      // Allow read if user is admin of the box OR the invitation belongs to their email\n      allow read: if isAdminOfBox(resource.data.boxId) || (\n        isSignedIn() && request.auth.token.email.lower() == resource.data.email.lower()\n      );\n      \n      // Allow create/update if admin of the target box\n      allow create, update: if isAdminOfBox(request.resource.data.boxId);\n      \n      // Allow delete only for admins or when accepted?\n      allow delete: if isAdminOfBox(resource.data.boxId);\n    }\n\n    // --- Legacy / Personal Mode / Shared Data ---\n\n    // Legacy Daily Classes (Fallback)\n    match /daily_classes/{classId} {\n      allow read: if isSignedIn();\n      allow write: if isSuperAdmin();\n\n      match /scores/{scoreUserId} {\n        allow read: if isSignedIn();\n        allow write: if isOwner(scoreUserId) || isSuperAdmin();\n      }\n    }\n\n    // Movemens (Shared/User-defined)\n    match /movements/{movementId} {\n      allow read: if isSignedIn();\n      allow create: if isSignedIn();\n      allow update, delete: if isSuperAdmin() || (resource.data.uid == request.auth.uid);\n    }\n\n    // User Logs (Personal Mode)\n    match /logs/{logId} {\n      allow read, write: if isSignedIn() && resource.data.uid == request.auth.uid;\n    }\n\n    // Calendar & Other personal data\n    match /calendar_entries/{entryId} {\n      allow read, write: if isSignedIn() && (resource.data.uid == request.auth.uid || request.resource.data.uid == request.auth.uid);\n    }\n\n    match /prs/{prId} {\n      allow read, write: if isSignedIn() && (resource.data.uid == request.auth.uid || request.resource.data.uid == request.auth.uid);\n    }\n  }\n}\n","name":"firestore.rules"}]},"createTime":"2026-01-14T05:37:40.393791Z","metadata":{"services":["cloud.firestore"]}}
[debug] [2026-01-14T05:37:40.851Z] [rules] created ruleset projects/crossfit-tracker-48563/rulesets/ac3cdffb-a428-429e-879b-815906669896
[info] i  firestore: deploying indexes... 
[debug] [2026-01-14T05:37:40.853Z] Checked if tokens are valid: true, expires at: 1768372653171
[debug] [2026-01-14T05:37:40.853Z] Checked if tokens are valid: true, expires at: 1768372653171
[debug] [2026-01-14T05:37:40.853Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/crossfit-tracker-48563/databases/(default)/collectionGroups/-/indexes [none]
[debug] [2026-01-14T05:37:41.764Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/crossfit-tracker-48563/databases/(default)/collectionGroups/-/indexes 200
[debug] [2026-01-14T05:37:41.765Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/crossfit-tracker-48563/databases/(default)/collectionGroups/-/indexes {"indexes":[{"name":"projects/crossfit-tracker-48563/databases/(default)/collectionGroups/draftLogs/indexes/CICAgOjXh4EK","queryScope":"COLLECTION","fields":[{"fieldPath":"status","order":"ASCENDING"},{"fieldPath":"uid","order":"ASCENDING"},{"fieldPath":"createdAt","order":"DESCENDING"},{"fieldPath":"__name__","order":"DESCENDING"}],"state":"READY","density":"SPARSE_ALL"},{"name":"projects/crossfit-tracker-48563/databases/(default)/collectionGroups/logs/indexes/CICAgJiUpoMK","queryScope":"COLLECTION","fields":[{"fieldPath":"uid","order":"ASCENDING"},{"fieldPath":"createdAt","order":"DESCENDING"},{"fieldPath":"__name__","order":"DESCENDING"}],"state":"READY","density":"SPARSE_ALL"},{"name":"projects/crossfit-tracker-48563/databases/(default)/collectionGroups/calendar_entries/indexes/CICAgJiUzYsK","queryScope":"COLLECTION","fields":[{"fieldPath":"type","order":"ASCENDING"},{"fieldPath":"uid","order":"ASCENDING"},{"fieldPath":"date","order":"ASCENDING"},{"fieldPath":"__name__","order":"ASCENDING"}],"state":"READY","density":"SPARSE_ALL"},{"name":"projects/crossfit-tracker-48563/databases/(default)/collectionGroups/prs/indexes/CICAgJiUsZIK","queryScope":"COLLECTION","fields":[{"fieldPath":"uid","order":"ASCENDING"},{"fieldPath":"date","order":"DESCENDING"},{"fieldPath":"__name__","order":"DESCENDING"}],"state":"READY","density":"SPARSE_ALL"}]}
[debug] [2026-01-14T05:37:41.765Z] Checked if tokens are valid: true, expires at: 1768372653171
[debug] [2026-01-14T05:37:41.765Z] Checked if tokens are valid: true, expires at: 1768372653171
[debug] [2026-01-14T05:37:41.765Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/crossfit-tracker-48563/databases/(default)/collectionGroups/-/fields?filter=indexConfig.usesAncestorConfig=false OR ttlConfig:* [none]
[debug] [2026-01-14T05:37:41.978Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/crossfit-tracker-48563/databases/(default)/collectionGroups/-/fields?filter=indexConfig.usesAncestorConfig=false OR ttlConfig:* 200
[debug] [2026-01-14T05:37:41.978Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/crossfit-tracker-48563/databases/(default)/collectionGroups/-/fields?filter=indexConfig.usesAncestorConfig=false OR ttlConfig:* {"fields":[{"name":"projects/crossfit-tracker-48563/databases/(default)/collectionGroups/__default__/fields/*","indexConfig":{"indexes":[{"queryScope":"COLLECTION","fields":[{"fieldPath":"*","order":"ASCENDING"}],"state":"READY"},{"queryScope":"COLLECTION","fields":[{"fieldPath":"*","order":"DESCENDING"}],"state":"READY"},{"queryScope":"COLLECTION","fields":[{"fieldPath":"*","arrayConfig":"CONTAINS"}],"state":"READY"}]}}]}
[debug] [2026-01-14T05:37:41.978Z] Checked if tokens are valid: true, expires at: 1768372653171
[debug] [2026-01-14T05:37:41.978Z] Checked if tokens are valid: true, expires at: 1768372653171
[debug] [2026-01-14T05:37:41.978Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/crossfit-tracker-48563/databases/(default) [none]
[debug] [2026-01-14T05:37:42.144Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/crossfit-tracker-48563/databases/(default) 200
[debug] [2026-01-14T05:37:42.144Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/crossfit-tracker-48563/databases/(default) {"name":"projects/crossfit-tracker-48563/databases/(default)","uid":"613fcf0d-08ce-49b6-b168-723cd4e97188","createTime":"2025-12-25T04:36:06.247128Z","updateTime":"2025-12-25T04:36:06.247128Z","locationId":"nam5","type":"FIRESTORE_NATIVE","concurrencyMode":"PESSIMISTIC","versionRetentionPeriod":"3600s","earliestVersionTime":"2026-01-14T04:37:41.726780Z","appEngineIntegrationMode":"DISABLED","keyPrefix":"s","pointInTimeRecoveryEnablement":"POINT_IN_TIME_RECOVERY_DISABLED","deleteProtectionState":"DELETE_PROTECTION_DISABLED","databaseEdition":"STANDARD","freeTier":true,"realtimeUpdatesMode":"REALTIME_UPDATES_MODE_ENABLED","etag":"IIuPho6oipIDMNTTgMiY2JED"}
[info] i  firestore: The following indexes are defined in your project but are not present in your firestore indexes file:
	(draftLogs) -- (status,ASCENDING) (uid,ASCENDING) (createdAt,DESCENDING)  -- Density:SPARSE_ALL 
	(logs) -- (uid,ASCENDING) (createdAt,DESCENDING)  -- Density:SPARSE_ALL 
	(calendar_entries) -- (type,ASCENDING) (uid,ASCENDING) (date,ASCENDING)  -- Density:SPARSE_ALL 
	(prs) -- (uid,ASCENDING) (date,DESCENDING)  -- Density:SPARSE_ALL  
